# Created by: {{ AUTHOR }}
# Automatically generated by Pwntest on {{ DATETIME }}

name: Auto-regenerate Tests

on:
  push:
    paths:
      - {{ MANIFEST_PATH }}


permissions:
  contents: write
  actions: write

jobs:
  create_tests:
    runs-on: {{ RUNS_ON }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          ref: {% raw %}${{ github.head_ref }}{%- endraw %}
      - name: Generate Tests
        uses: actions/setup-python@v3
        with:
          python-version: '3.10'
      - name: Install dependencies and Regenerate Actions
        run: |
          pip3 install ruamel.yaml # pwntest
          {%- if RUN_ON_CHANGED %}
          python3 pwntest/commandline/pwntest_action.py -r -m {{ MANIFEST_PATH }}
          # pwntest_action -r -m {{ MANIFEST_PATH }}
          {%- else %}
          python3 pwntest/commandline/pwntest_action.py -m {{ MANIFEST_PATH }}
          # pwntest_action -m {{ MANIFEST_PATH }}
          {% endif %}
      - name: Commit changes
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "Auto-regenerate tests"
          github_token: {% raw %}${{ secrets.GITHUB_TOKEN }}{%- endraw %}

